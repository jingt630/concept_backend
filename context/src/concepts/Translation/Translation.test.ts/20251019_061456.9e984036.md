---
timestamp: 'Sun Oct 19 2025 06:14:56 GMT-0400 (Eastern Daylight Time)'
content_id: 9e984036ce06c0820ffc9a3f9c96870c7c12967953430a4b2c2a7b83a1d18aaa
---

# file: src/concepts/Translation/Translation.test.ts

```typescript
import { assertEquals, assertThrows } from "jsr:@std/assert";
import { testDb } from "@utils/database.ts";
import TranslationConcept from "./Translation.ts";
import {ID} from "@utils/types.ts";

Deno.test("TranslationConcept: createTranslation", async () => {
  const [db, client] = await testDb();
  const translationConcept = new TranslationConcept(db);

  const imagePath = "path/to/image.jpg" as ID; // Assuming filePath is an ID
  const targetLanguage = "es";
  const originalText = "Hello, world!";
  const originalTextId = "text:123" as ID; // Assuming OriginalTextID is an ID

  const result = await translationConcept.createTranslation({
    imagePath,
    targetLanguage,
    originalText,
    originalTextId,
  });

  // Check if a translation ID was returned
  assertEquals(typeof result.translation, "string", "no translation ID assigned");

  // Verify the created translation in the database
  const createdTranslation = await db
    .collection("Translation.translations")
    .findOne({ _id: result.translation });
  assertEquals(createdTranslation?.imagePath, imagePath, "imagePath isn't passed to Translation obj");
  assertEquals(createdTranslation?.targetLanguage, targetLanguage, "target isn't passed to Translation obj");
  assertEquals(createdTranslation?.originalTextId, originalTextId, "originalID isn't passed to Translation obj");
  assertEquals(
    createdTranslation?.translatedText,
    `AI translated: "${originalText}" to ${targetLanguage}`, "AI didn't create a translation"
  );
  await client.close();
});

Deno.test("TranslationConcept: editTranslation", async () => {
  const [db, client] = await testDb();
  const translationConcept = new TranslationConcept(db);

  // Create a translation first
  const imagePath = "path/to/image.jpg" as ID;
  const targetLanguage = "fr";
  const originalText = "Bonjour le monde!";
  const originalTextId = "text:456" as ID;

  const { translation: translationId } = await translationConcept
    .createTranslation({
      imagePath,
      targetLanguage,
      originalText,
      originalTextId,
    });

  // Edit the translation
  const newText = "Bonjour, le monde!";
  const editResult = await translationConcept.editTranslation({
    translation: translationId,
    newText,
  });

  // Check if the edit was successful (returned empty object)
  assertEquals(editResult, {});

  // Verify the updated translation in the database
  const updatedTranslation = await db
    .collection("Translation.translations")
    .findOne({ _id: translationId });
  assertEquals(updatedTranslation?.translatedText, newText);

  await client.close();
});

Deno.test("TranslationConcept: editTranslation - not found", async () => {
  const [db, client] = await testDb();
  const translationConcept = new TranslationConcept(db);

  const nonExistentId = "nonexistent:id" as ID;
  const newText = "This should not be applied";

  const result = await translationConcept.editTranslation({
    translation: nonExistentId,
    newText,
  });

  // Check if an error was returned
  assertEquals(result, { error: "Translation not found" });
  await client.close();
});

Deno.test("TranslationConcept: changeLanguage", async () => {
  const [db, client] = await testDb();
  const translationConcept = new TranslationConcept(db);

  // Create a translation first
  const imagePath = "path/to/image.jpg" as ID;
  const targetLanguage = "de";
  const originalText = "Hallo Welt!";
  const originalTextId = "text:789" as ID;

  const { translation: translationId } = await translationConcept
    .createTranslation({
      imagePath,
      targetLanguage,
      originalText,
      originalTextId,
    });

  // Change the language
  const newTargetLang = "it";
  const changeLangResult = await translationConcept.changeLanguage({
    translation: translationId,
    newTargetLang,
  });

  // Check if the language change was successful (returned empty object)
  assertEquals(changeLangResult, {});

  // Verify the updated translation in the database
  const updatedTranslation = await db
    .collection("Translation.translations")
    .findOne({ _id: translationId });
  assertEquals(updatedTranslation?.targetLanguage, newTargetLang);
  assertEquals(
    updatedTranslation?.translatedText,
    `AI re-translated "${originalTextId}" to ${newTargetLang}`,
  );
  await client.close();
});

Deno.test("TranslationConcept: changeLanguage - not found", async () => {
  const [db, client] = await testDb();
  const translationConcept = new TranslationConcept(db);

  const nonExistentId = "nonexistent:id" as ID;
  const newTargetLang = "fr";

  const result = await translationConcept.changeLanguage({
    translation: nonExistentId,
    newTargetLang,
  });

  // Check if an error was returned
  assertEquals(result, { error: "Translation not found" });

  await client.close();
});

// Deno.test("TranslationConcept: _getTranslation", async () => {
//   const [db, client] = await testDb();
//   const translationConcept = new TranslationConcept(db);

//   // Create a translation first
//   const imagePath = "path/to/image.jpg" as ID;
//   const targetLanguage = "ja";
//   const originalText = "こんにちは世界";
//   const originalTextId = "text:101" as ID;

//   const { translation: translationId } = await translationConcept
//     .createTranslation({
//       imagePath,
//       targetLanguage,
//       originalText,
//       originalTextId,
//     });

//   // Retrieve the translation
//   const getResult = await (translationConcept as any )._getTranslation({
//     translationId,
//   });

//   // Check if the result is an array and contains the translation
//   assertEquals(Array.isArray(getResult), true);
//   assertEquals(getResult.length, 1);

//   const fetchedTranslation = getResult[0].translation;
//   assertEquals(fetchedTranslation._id, translationId);
//   assertEquals(fetchedTranslation.imagePath, imagePath);
//   assertEquals(fetchedTranslation.targetLanguage, targetLanguage);
//   assertEquals(fetchedTranslation.originalTextId, originalTextId);
//   assertEquals(
//     fetchedTranslation.translatedText,
//     `AI translated: "${originalText}" to ${targetLanguage}`,
//   );
// });

// Deno.test("TranslationConcept: _getTranslation - not found", async () => {
//   const [db, client] = await testDb();
//   const translationConcept = new TranslationConcept(db);

//   const nonExistentId = "nonexistent:id" as ID;

//   const getResult = await (translationConcept as any)._getTranslation({
//     translationId: nonExistentId,
//   });

//   // Check if the result is an array and contains an error
//   assertEquals(Array.isArray(getResult), true);
//   assertEquals(getResult.length, 1);
//   assertEquals(getResult[0], { error: "Translation not found" });
// });

```
